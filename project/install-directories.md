# Installation Directory Structure

Complete specification for ikigai installation paths using wrapper script approach.

## Overview

ikigai always installs to `~/.local` following XDG Base Directory conventions.
There is no PREFIX selection — ikigai is a personal user application and each
user is fully isolated.

System-wide install support is deferred until requirements are clear.

**Key insight:** The wrapper script sets all path environment variables at
runtime. The C code simply reads them — no install type detection needed.

## Install Structure

```
~/.local/
├── bin/ikigai                      # wrapper script (generated by make install)
└── libexec/ikigai/
    ├── ikigai                      # actual binary
    └── (tool binaries)

~/.local/share/ikigai/             # data files (XDG_DATA_HOME)
~/.config/ikigai/                  # config (XDG_CONFIG_HOME)
```

## Wrapper Script

Generated by `make install` at `~/.local/bin/ikigai`:

```bash
#!/bin/bash
IKIGAI_BIN_DIR=$HOME/.local/bin
IKIGAI_DATA_DIR=${XDG_DATA_HOME:-$HOME/.local/share}/ikigai
IKIGAI_LIBEXEC_DIR=$HOME/.local/libexec/ikigai
IKIGAI_CONFIG_DIR=${XDG_CONFIG_HOME:-$HOME/.config}/ikigai
IKIGAI_CACHE_DIR=${XDG_CACHE_HOME:-$HOME/.cache}/ikigai
IKIGAI_STATE_DIR=${XDG_STATE_HOME:-$HOME/.local/state}/ikigai
IKIGAI_RUNTIME_DIR=${XDG_RUNTIME_DIR:-/run/user/$(id -u)}/ikigai
export IKIGAI_BIN_DIR IKIGAI_DATA_DIR IKIGAI_LIBEXEC_DIR IKIGAI_CONFIG_DIR IKIGAI_CACHE_DIR IKIGAI_STATE_DIR IKIGAI_RUNTIME_DIR
exec $HOME/.local/libexec/ikigai/ikigai "$@"
```

XDG variables are resolved at runtime so users with non-default XDG dirs work correctly.

## Environment Variables

| Variable | Purpose | Default value |
|----------|---------|---------------|
| `IKIGAI_BIN_DIR` | Wrapper script directory | `~/.local/bin` |
| `IKIGAI_DATA_DIR` | Data files (migrations, system prompt) | `~/.local/share/ikigai` |
| `IKIGAI_LIBEXEC_DIR` | Helper executables (tools) | `~/.local/libexec/ikigai` |
| `IKIGAI_CONFIG_DIR` | Configuration files | `~/.config/ikigai` |
| `IKIGAI_CACHE_DIR` | Cache files (safe to delete) | `~/.cache/ikigai` |
| `IKIGAI_STATE_DIR` | Persistent state | `~/.local/state/ikigai` |
| `IKIGAI_RUNTIME_DIR` | Runtime files (sockets, PIDs) | `/run/user/<uid>/ikigai` |

## Development Mode

For development (running from source tree), `.envrc` sets the same variables
pointing into the source tree:

```bash
export IKIGAI_BIN_DIR=$PWD/bin
export IKIGAI_DATA_DIR=$PWD/share
export IKIGAI_LIBEXEC_DIR=$PWD/libexec
export IKIGAI_CONFIG_DIR=$PWD/etc
export IKIGAI_CACHE_DIR=$PWD/cache
export IKIGAI_STATE_DIR=$PWD/state
```

## Source Tree Layout

Files in the source tree mirror installed paths without the `ikigai/` subdir
(since the subdir is meaningful only at the installed path level):

```
etc/credentials.example.json       → ~/.config/ikigai/credentials.example.json
share/migrations/*.sql              → ~/.local/share/ikigai/migrations/
share/system/*                      → ~/.local/share/ikigai/system/
share/scripts/*                     → (not installed; dev tooling only)
libexec/                            → build artifacts (make output)
```

## Tool Discovery Paths

ikigai scans three directories for tools, in precedence order:

1. **Project tools:** `.ikigai/tools/` (relative to CWD) — project-specific
2. **User tools:** `~/.ikigai/tools/` (fixed) — personal custom tools
3. **System tools:** `$IKIGAI_LIBEXEC_DIR` — tools shipped with ikigai

Most specific wins when the same tool name exists in multiple directories.

## Installed Files

**Binaries:**
- Wrapper script: `~/.local/bin/ikigai`
- Actual binary: `~/.local/libexec/ikigai/ikigai`
- Tool binaries: `~/.local/libexec/ikigai/<name>-tool`

**Config files:** (`~/.config/ikigai/`)
- `credentials.example.json` — credentials template (installed if absent)

**Data files:** (`~/.local/share/ikigai/`)
- `migrations/*.sql` — database migrations
- `system/*` — default system prompt and shared resources

## Uninstall

```bash
make uninstall          # removes binaries and wrapper; preserves config/data
make PURGE=1 uninstall  # also removes config files and data directory
```
